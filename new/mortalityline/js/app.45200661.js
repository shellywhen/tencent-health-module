(function(t){function e(e){for(var n,s,d=e[0],c=e[1],l=e[2],_=0,h=[];_<d.length;_++)s=d[_],Object.prototype.hasOwnProperty.call(i,s)&&i[s]&&h.push(i[s][0]),i[s]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(t[n]=c[n]);o&&o(e);while(h.length)h.shift()();return r.push.apply(r,l||[]),a()}function a(){for(var t,e=0;e<r.length;e++){for(var a=r[e],n=!0,d=1;d<a.length;d++){var c=a[d];0!==i[c]&&(n=!1)}n&&(r.splice(e--,1),t=s(s.s=a[0]))}return t}var n={},i={app:0},r=[];function s(e){if(n[e])return n[e].exports;var a=n[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=t,s.c=n,s.d=function(t,e,a){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(s.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(a,n,function(e){return t[e]}.bind(null,n));return a},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="";var d=window["webpackJsonp"]=window["webpackJsonp"]||[],c=d.push.bind(d);d.push=e,d=d.slice();for(var l=0;l<d.length;l++)e(d[l]);var o=c;r.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var n=a("85ec"),i=a.n(n);i.a},"56d7":function(t,e,a){"use strict";a.r(e);var n={};a.r(n),a.d(n,"init",(function(){return K})),a.d(n,"updateView",(function(){return Z}));a("e260"),a("e6cf"),a("cca6"),a("a79d");var i=a("2b0e"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"app"}},[a("Scatter",{attrs:{msg:"Welcome to Your Vue.js App"}})],1)},s=[],d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%",height:"100%"}},[a("svg",{attrs:{id:"worldComparison"}}),a("div",{staticStyle:{"margin-top":"6.67vw"},attrs:{id:"total_mortality"}},[a("div",{staticClass:"title_mortality"},[t._v("全国新冠肺炎累计感染/病亡人数")]),t._m(0),a("div",{staticClass:"total_svg_div",staticStyle:{width:"100%",height:"35vw","margin-top":"3vw"}},[a("div",{staticClass:"y_label",staticStyle:{"margin-top":"1.8vw"}},t._l(t.add_y_label,(function(e,n){return a("div",{key:e+"-"+n,staticClass:"label_text",style:"margin-bottom: 4vw; font-weight: "+(0===e?600:400)+";"},[t._v(t._s(t.num2text(e)))])})),0),a("div",{staticClass:"life_svg_div_mortality"},[a("div",{staticClass:"highlight_svg_div_mortality",staticStyle:{"pointer-events":"none"}},[a("svg",{attrs:{width:"100%",height:"100%"}},[a("defs",[a("linearGradient",{attrs:{id:"orange_red",x1:"100%",y1:"0%",x2:"100%",y2:"100%"}},[a("stop",{staticStyle:{"stop-color":"rgb(0, 186, 209)","stop-opacity":"0.05"},attrs:{offset:"0%"}}),a("stop",{staticStyle:{"stop-color":"rgb(0, 186, 209)","stop-opacity":"0.25"},attrs:{offset:"100%"}})],1)],1),a("rect",{attrs:{x:t.hightlight_rect.x,y:t.hightlight_rect.y,width:t.hightlight_rect.width,height:t.hightlight_rect.height,fill:"url(#orange_red)"}})])]),a("div",{staticClass:"life_svg_div_mortality_big",style:"height: 100%; width: "+t.dataLens/t.showLens*100+"%; overflow: visible;"},[a("svg",{staticStyle:{background:"none"},attrs:{width:"100%",height:"100%"}},[a("g",{attrs:{id:"horizontal_line"}},t._l(t.add_y_label,(function(e,n){return a("path",{key:"add_y_line"+n,style:"stroke-width: "+(t.bold_line_index_list.includes(n)?.3:.08)+"vw; stroke: #6f6f6f;",attrs:{d:t.bold_line_index_list.includes(n)?"":"M0,"+t.add_y_step*(.5+n)+"h"+t.add_svg_width}})})),0),a("g",{staticClass:"bar_chart"},[a("g",{staticClass:"bar_char_diagnosis"},[t._l(t.country_dataset,(function(e,n){return a("rect",{key:"bar-rect-diagnosis-"+n,staticClass:"diagnosis",attrs:{width:1.4*t.add_x_step,height:Math.log10(e.total_diagnosis)/Math.log10(t.add_y_label[0])*t.add_y_step*2,x:t.add_x_begin+t.add_x_step*(2*n+.3),y:(1-Math.log10(e.total_diagnosis)/Math.log10(t.add_y_label[0]))*t.add_y_step*2+.5*t.add_y_step}})})),t._l(t.country_dataset,(function(e,n){return a("text",{directives:[{name:"show",rawName:"v-show",value:n===t.select_date_id,expression:"index===select_date_id"}],key:"bar-label-cure-"+n,staticClass:"label_text",attrs:{x:t.add_x_begin+t.add_x_step*(2*n+1),y:(1-Math.log10(e.total_diagnosis)/Math.log10(t.add_y_label[0]))*t.add_y_step*2+.4*t.add_y_step}},[t._v(t._s(t.num2text(e.total_diagnosis)))])}))],2),a("g",{attrs:{id:"bar_chart_death"}},[t._l(t.country_dataset,(function(e,n){return a("rect",{key:"bar-rect-death-"+n,staticClass:"death",attrs:{width:1.4*t.add_x_step,height:Math.log10(e.total_death)/Math.log10(t.add_y_label[4])*t.add_y_step*1,x:t.add_x_begin+t.add_x_step*(2*n+.3),y:3.5*t.add_y_step}})})),t._l(t.country_dataset,(function(e,n){return a("text",{directives:[{name:"show",rawName:"v-show",value:n===t.select_date_id,expression:"index===select_date_id"}],key:"bar-label-death-"+n,staticClass:"label_text",attrs:{x:t.add_x_begin+t.add_x_step*(2*n+1),y:Math.log10(e.total_death)/Math.log10(t.add_y_label[4])*t.add_y_step*1+3.85*t.add_y_step}},[t._v(t._s(t.num2text(e.total_death)))])}))],2)]),a("g",{attrs:{id:"x-label"}},t._l(t.date_list,(function(e,n){return a("text",{directives:[{name:"show",rawName:"v-show",value:n===t.select_date_id,expression:"index===select_date_id"}],key:e.month+"-"+e.day,style:n===t.select_date_id?"text-anchor: middle; font-size: 2.4vw; font-weight: 500; fill: '#333333'; transform: translate(0, 0.1vw); transition: ease 0.2s;":"text-anchor: middle; font-size: 2.1333333vw; font-weight: 400; fill: '#333333';",attrs:{x:t.add_x_begin+t.add_x_step*(2*n+1),y:3.1*t.add_y_step}},[t._v(t._s(e.month+"/"+e.day))])})),0),a("g",{attrs:{id:"horizontal_line_0"}},t._l(t.add_y_label,(function(e,n){return a("path",{key:"add_y_line"+n,style:"stroke-width: "+(t.bold_line_index_list.includes(n)?.3:.08)+"vw; stroke: #6f6f6f;",attrs:{d:t.bold_line_index_list.includes(n)?"M0,"+t.add_y_step*(.5+n)+"h"+t.add_svg_width:""}})})),0)])])])]),a("div",{attrs:{id:"slider_mortality"}},[a("svg",{attrs:{id:"slider_svg2",width:"100%",height:"100%"}},[a("defs",[a("linearGradient",{attrs:{id:"slider_linear"}},[a("stop",{staticStyle:{"stop-color":"#60cad7","stop-opacity":"1"},attrs:{offset:"15%"}}),a("stop",{staticStyle:{"stop-color":"#00bad1","stop-opacity":"1"},attrs:{offset:"95%"}})],1),a("filter",{attrs:{id:"shadow",x:"-5%",y:"0%",width:"110%",height:"120%"}},[a("feDropShadow",{attrs:{dx:"0",dy:"0.6",stdDeviation:"1.2","flood-color":"#00B9D1","flood-opacity":"0.6"}})],1)],1)])]),a("div",{staticClass:"description",staticStyle:{"margin-bottom":"3.472vh"}},[t._v("*拖动图表查看更多时间范围数据，移动滑块选择日期，图表将同步变化")])]),t._m(1)])},c=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"legend",staticStyle:{"margin-top":"3vw"}},[a("div",{staticClass:"legend_icon diagnosis"}),a("span",{staticClass:"legend_text"},[t._v("感染人数")]),a("div",{staticClass:"legend_icon death"}),a("span",{staticClass:"legend_text"},[t._v("病亡人数")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{attrs:{id:"data-description"}},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-title"},[a("h1",[t._v("数据说明")])]),a("div",{staticClass:"card-detail"},[a("p",[t._v("新冠肺炎数据来源于国家卫健委。由于当前疫情尚未结束，粗病死率是当日卫健委公布的因感染新型冠状病毒死亡的病例数量占累计报告确诊病例的比例；其他历史疫情为根据文献计算所得病死率。")]),a("p",[t._v("关于其他重大历史疾病的数据来源请访问北京大学可视化与可视分析实验室疫情轨迹线主页查看。")])]),a("div",{staticClass:"card-line"}),a("div",{staticClass:"card-close"},[t._v("关闭")])])])}],l=(a("99af"),a("4160"),a("a15b"),a("6b93"),a("d3b7"),a("ac1f"),a("3ca3"),a("466d"),a("1276"),a("159b"),a("ddb0"),a("96cf"),a("1da1")),o=(a("c975"),a("a9e3"),a("5698")),_="prod",h={countryHistory:{dev:"https://ehcard-test.wecity.qq.com/api",prod:"https://wechat.wecity.qq.com/api",requestBody:{args:{req:{none:""}},service:"THOuterDataServer",func:"getAreaInfo",context:{}}},country:{dev:"https://ehcard-test.wecity.qq.com/api",prod:"https://wechat.wecity.qq.com/api",requestBody:{service:"THOuterDataServer",func:"getChinaTotal",args:{req:{none:"none"}}}},province:{dev:"https://ehcard-test.wecity.qq.com/api",prod:"https://wechat.wecity.qq.com/api",requestBody:{args:{req:{none:""}},service:"THOuterDataServer",func:"getAreaInfo",context:{}}},city:{dev:"https://ehcard-test.wecity.qq.com/api",prod:"https://wechat.wecity.qq.com/api",requestBody:{args:{req:{area:"湖北"}},service:"THOuterDataServer",func:"getCityInfo"}}},u=function(t){t["requestBody"];var e={method:"POST",headers:[["Content-Type","application/json"]],body:JSON.stringify(t["requestBody"])};return o["g"](t[_],e)};var y="<g stroke='none' stroke-width='1' fill='#888888' fill-rule='evenodd'><path d='M13.7079134,16.3613541 C13.2959223,16.3613541 12.9631971,16.0075163 12.9631971,15.5769046 C12.9631971,12.4857267 15.5650202,11.1871705 15.5777237,11.1804799 C16.2178253,10.6430325 16.5854414,10.0622031 16.4999398,9.21429983 C16.4396711,8.60340863 15.7963791,7.84562981 14.9185669,7.64866968 C14.0026444,7.4283688 12.8554501,7.74881478 12.2723108,8.28626215 C11.5212428,8.98391723 11.4895712,10.0421619 11.4895712,10.0555126 C11.4800291,10.4828248 11.1504363,10.8233425 10.7447969,10.826642 L10.7352548,10.826642 C10.3264831,10.8199819 9.99686118,10.4694741 10.0000226,10.0388319 C10.0000226,9.96874864 10.0253714,8.29631329 11.2708577,7.12460347 C12.1993966,6.24999889 13.6825646,5.7325622 15.3780073,6.14316322 C18.3221557,7.17803661 18.109823,9.41129057 17.8784641,10.2357921 C17.6598086,11.0269322 17.2731373,11.9616605 16.1671566,12.609243 L16.170318,12.6192942 C16.1037265,12.6526555 14.4621428,13.5005589 14.4621428,15.5702445 C14.4558201,16.0108463 14.1199625,16.3613541 13.7079134,16.3613541 Z M12.801591,18.8817233 C12.801591,19.4992745 13.2769542,20 13.8632258,20 C14.4494684,20 14.9248896,19.499244 14.9248896,18.8817233 C14.9248896,18.2641415 14.4494394,17.763416 13.8632258,17.763416 C13.2769542,17.7633855 12.801591,18.2641415 12.801591,18.8817233 Z'></path><path d='M13.4999537,0 C6.04458431,0 -3.01839914e-08,6.0446083 0,13.5 C3.01839914e-08,20.9553917 6.04461522,27 13.4999537,27 C20.955323,27 27,20.9553917 27,13.5 C27,6.04460827 20.955323,0 13.4999537,0 Z M13.4999537,25.5149632 C6.8647392,25.5149632 1.48497665,20.1352069 1.48497668,13.5 C1.48497668,6.86476222 6.8647392,1.48500586 13.4999537,1.48500586 C20.135199,1.48500586 25.5149307,6.86473134 25.5149307,13.5 C25.5149307,20.1352068 20.135199,25.5149632 13.4999537,25.5149632 Z' ></path></g>",p=a("1157"),g=a.n(p),f=-18,m=-20,v=[{confirm:2499,death:861,death_dx:0,death_dy:28,death_time_dy:25,flag:1,name:"MERS","name-cn":"中东呼吸综合征",rate:.344537815,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"2012-2019"},{confirm:28616,death:11310,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"Ebola","name-cn":"埃博拉",rate:.395233436,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"2014-2016"},{confirm:1311522,death:14142,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"H1N1","name-cn":"甲型H1N1流感",rate:.010766473648700002,rate_dx:0,rate_dy:-72,rate_time_dy:m,time:"2009-2010"},{confirm:57628,death:3145,death_dx:0,death_dy:f,death_time_dy:m,flag:0,name:"Polio","name-cn":"小儿麻痹症",rate:.054574165,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"1952"},{confirm:15e6,death:2e6,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"Smallpox","name-cn":"天花",rate:.133333333,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"19-20世纪期间"},{confirm:8422,death:916,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"SARS","name-cn":"非典",rate:.108762764,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"2002-2003"},{confirm:26e6,death:14e3,death_dx:0,death_dy:f,death_time_dy:m,flag:0,name:"Seasonal flu","name-cn":"季节性流感 (美国)",rate:5e-4,rate_dx:0,rate_dy:-140,rate_time_dy:m,time:"2019-2020"},{confirm:53e5,death:8900,death_dx:0,death_dy:28,death_time_dy:25,flag:1,name:"Chickenpox","name-cn":"水痘",rate:.0016699999999999998,rate_dx:0,rate_dy:-16,rate_time_dy:-18,time:"1990"},{confirm:9769400,death:142300,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"Measles","name-cn":"麻疹",rate:.014565888999999999,rate_dx:0,rate_dy:-40,rate_time_dy:m,time:"2018"},{confirm:17e5,death:77e4,death_dx:0,death_dy:f,death_time_dy:m,flag:1,name:"HIV","name-cn":"人类免疫缺陷病毒",rate:.452941176,rate_dx:0,rate_dy:f,rate_time_dy:m,time:"2018"}],x={yType:"normal",xType:"log",commonRadius:8,highlightRadius:7,normalRadius:200,fadeRadius:0,tickNumber:4,width:633,height:847,tickWidth:618,rate_dx:12,rate_dy:12,rate_time_dx:-55,rate_time_dy:-18,death_dx:10,death_dy:6,death_time_dx:-60,death_time_dy:20},w=["一","十","百","千","万","十万","百万","千万","亿","十亿","千亿"],b=1187,S=750,k={top:263,bottom:0,left:67,right:48},C=1200,M=12,T=4,q=99999999,O=.5,A=1e7,L=1,P=function(){var t=x.title,e=t.append("g"),a=e.append("g").attr("transform","translate(".concat(45,", ",73,")"));a.append("rect").attr("height",34).attr("width",8).style("rx",4).style("ry",4).style("fill","#21d8e6");var n=e.append("g").attr("transform","translate(".concat(68,", ",103,")"));n.append("text").classed("bigTitle",!0).text("疫情轨迹线"),n.append("g").attr("transform","translate(".concat(-23,", ",103,")")).append("text").classed("secondTitle",!0).text("新冠肺炎与其他重大传染病感染/死亡情况对比");var i=e.append("g").attr("transform","translate(".concat(68,", ",146,")")),r=(i.append("text").classed("subTitle",!0).text("截至 ".concat(x.updateTime," 国家卫健委数据统计 ")),document.querySelector(".subTitle").getBBox()),s=r.width,d=e.append("g").attr("transform","translate(".concat(68+s+5,",").concat(122,")"));d.append("g").html(y),d.append("rect").attr("height",27).attr("width",27).style("opacity",0).style("cursor","pointer").on("click",(function(){o["l"]("#data-description").style("display","block")}))},j=function(t){U(),Y();var e="confirm",a="rate";I(e,a),H(e,a)},N=function(t){console.log(t);var e=t["args"]["rsp"]["chinaTotalUpdateTime"];x.updateTime=e;var a=t["args"]["rsp"]["chinaHistoryTotal"];return a.forEach((function(t,e){var a=t["day"].substring(0,2),n=t["day"].substring(3,2),i="2020年".concat(Number(a),"月").concat(n,"日");t["rate"]=t["dead"]/t["confirm"],t["time"]=i,t["death"]=t["dead"],t["offset"]=e})),x.tid=a.length-1,x.currentTimeIdx=a.length-1,a},B=function(){var t=["季节性流感 (美国)","甲型H1N1流感","麻疹"];x.world.forEach((function(e){if(-1!=t.indexOf(e["name-cn"])){var a=e["rate_dy"]+2*M,n=x.xScale(e["confirm"]),i=x.yScale(e["rate"])-M;x.canvas.append("line").classed("additive-line",!0).attr("x1",n).attr("x2",n).attr("y1",i).attr("y2",i+a)}}))},E=function(){"death"!=x.yTag?x.canvas.selectAll(".additive-line").style("opacity",0).transition().delay(C/2).duration(C/2).style("opacity",1):x.canvas.selectAll(".additive-line").style("opacity",0)},R=function(){return console.log(h),u(h["countryHistory"]).then((function(t){console.log(t,"shot");var e=N(t);x.country=e,x.world=v,x.xMax=o["i"](x.world,(function(t){return t["confirm"]})),x.yMax=o["i"](x.world,(function(t){return t["rate"]}))}))},W=function(){var t;x.gYscale.selectAll("g").remove();var e=C/5;"normal"==x.yType?(x.canvas.select(".time-label").attr("y",80),t=o["j"]().domain([0,O]).range([x.height,0]),x.gYscale.transition().duration(e).call(o["b"](t).ticks(x.tickNumber).tickFormat((function(t){return"".concat(100*t,"%")})))):(x.canvas.select(".time-label").attr("y",x.height-20),x.yTag="death",x.yMax=o["i"](x.world,(function(t){return t["death"]})),t=o["k"]().domain([L,A]).range([x.height,0]),x.gYscale.transition().ease(o["d"]).duration(e).call(o["b"](t).ticks(x.tickNumber).tickFormat((function(t){return"".concat(w[Math.log10(t)])})))),x.yScale=t,x.gYscale.selectAll(".tick line").classed("tick-line",!0).attr("y2",0).transition().ease(o["d"]).duration(e+1).attr("x2",x.tickWidth),g()(".y-axis .tick").insertBefore(g()(".solidDomain")),x.gYscale.selectAll(".tick text").classed("tick-text-mortality",!0).attr("dy",8).style("text-anchor","end").transition().delay(e+1).duration(0).attr("x",-4),x.gYscale.select(".domain").remove()},D=function(t,e){x.canvas.selectAll(".world").transition().ease(o["e"]).duration(C).attr("transform",(function(a,n){return"translate(".concat(x.xScale(a[t]),", ").concat(x.yScale(a[e]),")")}));var a=x.canvas.selectAll(".disease").transition().ease(o["e"]).duration(C).attr("x",(function(e){return x.xScale(e[t])})).attr("y",(function(t){return x.yScale(t[e])}));a.select(".disease-note").attr("dx",(function(t){return t["".concat(e,"_dx")]})).attr("dy",(function(t){return t["".concat(e,"_dy")]})),a.select(".time-note").attr("dx",(function(t){return t["".concat(e,"_dx")]})).attr("dy",(function(t){return t["".concat(e,"_time_dy")]})),E()},H=function(t,e){var a=o["h"]().x((function(e){return x.xScale(e[t])})).y((function(t){return x.yScale(t[e])})),n=$(x.country);x.canvas.append("g").classed("line-layer",!0).selectAll("path").data(n).enter().append("path").attr("d",(function(t){return a(t)})).attr("class",(function(t){return"lines country-line pl_".concat(t[1]["offset"])})),x.canvas.append("g").classed("dot-layer",!0).selectAll(".country").data(x.country).enter().append("rect").attr("transform",(function(a,n){return"translate(".concat(x.xScale(a[t]),",").concat(x.yScale(a[e]),")")})).attr("class",(function(t,e){return"country p_".concat(t["offset"])})).attr("width",(function(t,e){return e==x.country.length-1?M:T})).attr("height",(function(t,e){return e==x.country.length-1?M:T})).attr("x",(function(t,e){return e==x.country.length-1?-M/2:-T/2})).attr("y",(function(t,e){return e==x.country.length-1?-M/2:-T/2})).style("fill","#de5e5b").style("fill-opacity",(function(t,e){return e==x.country.length-1?0:1})).style("stroke",(function(t,e){return"#de5e5b"}));var i=x.canvas.append("text").classed("countryId",!0).classed("highlightElement",!0).attr("x",x.xScale(x.country[x.country.length-1][t])).attr("y",x.yScale(x.country[x.country.length-1][e]));i.append("tspan").classed("disease-name",!0).attr("dx",(function(t){return x["".concat(e,"_dx")]})).attr("dy",(function(t){return x["".concat(e,"_dy")]})).text("新冠肺炎"),i.append("tspan").classed("disease-period",!0).attr("dx",(function(t){return x["".concat(e,"_time_dx")]})).attr("dy",(function(t){return x["".concat(e,"_time_dy")]})).text("2019-")},Y=function(){var t,e;x.gXscale.selectAll("g").remove(),t=o["k"]().domain([100,q]).range([0,x.width]),x.gXscale.call(o["a"](t).ticks(6).tickFormat((function(t){return Math.log10(t)%1?"":"".concat(w[Math.log10(t)])}))),x.gXscale.selectAll(".tick").each((function(t){Math.log10(t)%1&&o["l"](this).remove()})),x.gXscale.selectAll(".tick").select("line").attr("y2",-x.height).classed("tick-line",!0),x.gXscale.select(".domain").remove(),x.gXscale.select(".tick line").style("stroke-dasharray",0).style("stroke","black"),x.gXscale.selectAll(".tick text").classed("tick-text-mortality",!0),x.xScale=t,"normal"==x.yType?(e=o["j"]().domain([0,O]).range([x.height,0]),x.gYscale.call(o["b"](e).ticks(x.tickNumber).tickFormat((function(t){return"".concat(100*t,"%")})))):(x.yTag="death",e=o["k"]().domain([100,A]).range([x.height,0]),x.gYscale.call(o["b"](e).ticks(x.tickNumber).tickFormat((function(t){return"".concat(w[Math.log10(t)])})))),x.yScale=e,x.gYscale.append("line").classed("solidDomain",!0).attr("y1",x.height).attr("y2",x.height).attr("x2",x.width).style("stroke","black"),x.gYscale.selectAll(".tick line").classed("tick-line",!0).attr("x2",x.tickWidth),x.gYscale.selectAll(".tick text").classed("tick-text-mortality",!0).style("text-anchor","end").attr("x",-4).attr("dy",8),x.gYscale.select(".domain").remove()},I=function(t,e){x.canvas.append("g").classed("dot-layer",!0).selectAll(".world").data(x.world).enter().append("rect").attr("transform",(function(a){return"translate(".concat(x.xScale(a[t]),", ").concat(x.yScale(a[e]),")")})).attr("x",(function(t){return-M/2})).attr("y",(function(t){return-M/2})).attr("height",M).attr("width",M).attr("class",(function(t,e){return"world w_".concat(e)}));var a=x.canvas.append("g").classed("annotation",!0).selectAll("text").data(x.world).enter().append("text").attr("x",(function(e){return x.xScale(Number(e[t]))})).attr("y",(function(t){return x.yScale(Number(t[e]))})).attr("class",(function(t,e){return"disease w_".concat(e)}));a.append("tspan").classed("disease-note",!0).attr("x",(function(e){return x.xScale(Number(e[t]))})).attr("dx",(function(t){return t["".concat(e,"_dx")]})).attr("dy",(function(t){return t["".concat(e,"_dy")]})).text((function(t){return t["name-cn"]})),a.append("tspan").classed("time-note",!0).attr("x",(function(e){return x.xScale(Number(e[t]))})).attr("dx",(function(t){return t["".concat(e,"_dx")]})).attr("dy",(function(t){return t["".concat(e,"_time_dy")]})).text((function(t){return t["time"]})),B()},V=function(t,e){var a=o["h"]().x((function(e){return x.xScale(e[t])})).y((function(t){return x.yScale(t[e])})),n=x.canvas.select(".countryId").attr("x",x.xScale(x.country[x.tid][t])).attr("y",x.yScale(x.country[x.tid][e]));n.select(".disease-name").attr("dx",(function(t){return x["".concat(e,"_dx")]})).attr("dy",(function(t){return x["".concat(e,"_dy")]})),n.select(".disease-period").attr("dx",(function(t){return x["".concat(e,"_time_dx")]})).attr("dy",(function(t){return x["".concat(e,"_time_dy")]})),n.style("opacity",0).transition().delay(C).style("opacity",1),x.canvas.selectAll(".lines").attr("d",(function(t){return a(t)})).style("opacity",0).transition().delay((function(t,e){return C/2})).duration(C/2).style("opacity",1),x.canvas.selectAll(".country").attr("class",(function(t,e){return"country p_".concat(t["offset"])})).style("visibility",(function(t,e){return e>x.tid?"hidden":"visible"})).style("opacity",1).transition().duration((function(t,e){return C})).attr("transform",(function(a){return"translate(".concat(x.xScale(a[t]),", ").concat(x.yScale(a[e]),")")}))},X=function(t){x.tid=t,o["m"](".country-line").style("opacity",1);x.canvas.select(".countryId").attr("x",Math.max(0,x.xScale(x.country[t][x.xTag]))).attr("y",x.yScale(x.country[t][x.yTag]));for(var e=t+1;e<=x.currentTimeIdx;e++)o["m"](".p_".concat(e)).style("visibility","hidden").attr("width",T).attr("height",T).style("fill-opacity",1).style("x",-T/2).style("y",-T/2),o["m"](".pl_".concat(e)).style("visibility","hidden");o["m"](".p_".concat(t)).style("visibility","visible").attr("width",M).attr("height",M).style("fill-opacity",0).style("x",-M/2).style("y",-M/2),o["m"](".pl_".concat(t)).style("visibility","visible");for(var a=0;a<t;a++)o["m"](".p_".concat(a)).style("visibility","visible").attr("width",T).classed("highlightElement",!1).attr("height",T).style("fill-opacity",1).style("x",-T/2).style("y",-T/2),o["m"](".pl_".concat(a)).style("visibility","visible")},F=function(){var t=o["l"](".active-text"),e=o["l"](".inactive-text"),a=o["l"](".active-button"),n=o["l"](".inactive-button");t.classed("active-text",!1).classed("inactive-text",!0),e.classed("active-text",!0).classed("inactive-text",!1),a.classed("active-button",!1).classed("inactive-button",!0),n.classed("active-button",!0).classed("inactive-button",!1),x.yType="normal"==x.yType?"log":"normal",W();var i="confirm",r="normal"==x.yType?"rate":"death";x.xTag=i,x.yTag=r,D(i,r),V(i,r)},z=function(t){var e=105,a=85,n=255,i=40,r=28,s=6,d=x.svg.append("g").attr("transform","translate(".concat(a,", ").concat(n,")"));d.append("defs").append("clipPath").attr("id","clip-button").append("rect").attr("rx",s).attr("ry",s).attr("height",i).attr("width",2*e);d.append("rect").attr("x",0).attr("y",0).attr("rx",s).attr("ry",s).attr("height",i).attr("width",2*e).style("stroke","#888888").style("stroke-width",.5).style("fill-opacity",0);d.append("rect").attr("width",e).attr("height",i).classed("active-button toggleButton",!0).on("click",(function(){F()})),d.append("rect").attr("x",e).attr("width",e).attr("height",i).classed("inactive-button toggleButton",!0).on("click",(function(){F()}));d.append("text").classed("button-text active-text",!0).attr("x",e/2).attr("y",r).text("(粗)病死率").on("click",(function(){F()})),d.append("text").classed("button-text inactive-text",!0).attr("x",e/2+e).attr("y",r).text("病亡人数").on("click",(function(){F()}))},U=function(){x.height,x.width,x.svg.append("defs").append("clipPath").attr("id","mainCanvasClip").append("rect").attr("height",x.height+20).attr("width",x.width+40).attr("x",0).attr("y",0);x.canvas.style("clip-path","url(#mainCanvasClip)");var t=x.svg.append("g").attr("transform","translate(".concat(k.left,", ").concat(k.top,")")),e=t.append("text").attr("x",x.width).attr("y",x.height+30).attr("dy",20).classed("axis-label",!0);e.append("tspan").text("确诊").attr("dy",13).attr("dx",0),e.append("tspan").text("人数").attr("dy",25).attr("dx",-40),z(t);var a=x.svg.append("g").attr("transform","translate(".concat(40,", ",1179,")"));a.append("text").classed("fig-annotation",!0).text("*本图表采用对数坐标系"),a.append("text").style("text-anchor","end").attr("x")},$=function(t){for(var e=[],a=0;a<t.length;a++){if(a==t.length-1)break;e.push([t[a],t[a+1]])}return e},J=function(t){var e=document.querySelector("body").clientWidth,a=e/S*b,n=o["l"]("#".concat(t)).attr("width",e).attr("height",a).attr("viewBox","0 0 ".concat(S," ").concat(b)),i=n.append("g").attr("transform","translate(".concat(k.left,", ").concat(k.top,")"));x.svg=n,x.title=n.append("g"),x.gXscale=i.append("g").classed("x-axis",!0).attr("transform","translate(0, ".concat(x.height,")")),x.gYscale=i.append("g").classed("y-axis",!0),x.canvas=i.append("g").classed("scatter-view",!0),x.xTag="confirm",x.yTag="rate"},Z=function(t){X(t)},G=function(){var t=navigator.userAgent.toLowerCase(),e="Roboto, SourceHanSansCN, “思源黑体”, Noto Sans SC";/\(i[^;]+;( U;)? CPU.+Mac OS X/gi.test(t)&&(e="PingFang SC"),o["l"]("body").style("font-family",e)},K=function(){var t=Object(l["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return G(),J("worldComparison"),t.next=4,R();case 4:P(),j(x.svg);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();o["n"].prototype.last=function(){var t=this.size()-1;return o["l"](this._groups[0][t])};var Q={name:"Mortalityline",props:{msg:String},data:function(){return{ScatterPlot:n,country_dataset:[],date_list:[],add_y_label:[],add_y_step:0,add_x_begin:0,add_x_step:0,add_x_end:0,dataLens:0,showLens:10,hightlight_rect:{x:0,y:0,width:100,height:100},bold_line_index_list:[2,3],select_date_id_slider:0,select_date_id_bar:0,select_date_id:0,isiOS:!1,dataViewWidth:0,max_scroll_distance:0}},watch:{select_date_id_slider:function(){if(o["l"](".highlight_svg_div_mortality").node()){var t=o["l"](".highlight_svg_div_mortality").node().getBoundingClientRect(),e=t.width,a=2.6*this.add_x_step,n=8.5*this.add_y_step,i=e-this.add_x_end-a/2-2*(this.showLens-1-this.select_date_id_slider)*this.add_x_step-1*this.add_x_step,r=.5*this.add_y_step;this.hightlight_rect={x:i,y:r,width:a,height:n}}},select_date_id:function(t){this.ScatterPlot.updateView(t)}},methods:{set_slider:function(){var t=this,e=o["l"]("#slider_mortality").node().getBoundingClientRect().width,a=o["l"]("#slider_mortality").node().getBoundingClientRect().height,n={left:.03*e,right:.05*e,top:0,bottom:0},i=function(i,r){var s=o["l"]("#".concat(i));s.attr("height",a).attr("width",e);var d=s.append("g").attr("transform","translate(".concat(n.left,", ").concat(n.top,")")),c=e-n.left-n.right,l=a-n.top-n.bottom,_=c/r,h=.8*l,u=4*_,y=o["j"]().range([.5*-u+.5*_,c-.5*_-.5*u]).domain([0,r-1]),p=d.append("g");p.append("line").attr("x1",.02*-c).attr("x2",c+.22*_).attr("y1",.5*l).attr("y2",.5*l).style("stroke","#ececec").style("stroke-width",.2*l).style("stroke-linecap","round");var g=p.append("g"),f=[0,1,2];g.append("rect").attr("x",_*r-.5*_-.5*u).attr("y",l/2-.25*h).attr("width",u).attr("height",.75*h).attr("class","bar_g_mortality").attr("rx",.1*u).attr("ry",.1*u).classed("slider-rect-shadow",!0);var m=p.append("rect").attr("x",_*r-.5*_-.5*u).attr("y",l/2-h/2).attr("width",u).attr("height",h).attr("rx",.1*u).attr("ry",.1*u).classed("slider-rect",!0);p.append("g").selectAll("rect").data(f).enter().append("rect").attr("class","bar_g_mortality").attr("x",(function(t,e){return _*r-.5*_-.5*u+.28*u+.2*e*u})).attr("y",l/2-.23*h).attr("width",.04*u).attr("height",.46*h).style("fill","#ffffff").attr("rx",.02*_).attr("ry",.02*_),m.call(o["c"]().on("drag",(function(){var e=Math.min(Math.max(.5*-u+.5*_,o["f"].x),c-.5*_-.5*u),a=o["l"](this);a.attr("x",e);var n=Math.round(y.invert(e)),i=n*_-.5*u+.5*_;a.attr("x",i),o["m"](".bar_g_mortality").attr("transform","translate(".concat((n-r+1)*_,", 0)")),t.select_date_id_slider=n,t.select_date_id=t.select_date_id_slider+t.select_date_id_bar})).on("end",(function(){})))};this.select_date_id_slider=this.showLens-1;var r="slider_svg2";i(r,this.showLens),this.select_date_id_bar=this.dataLens-this.showLens},set_scroll_by_addEvent:function(){var t=this,e=null;document.querySelector(".life_svg_div_mortality").addEventListener("scroll",(function(a){if(!t.isiOS){t.scroll_left=a.target.scrollLeft,clearTimeout(e);var n=t.scroll_left;t.max_scroll_distance=-t.dataViewWidth+t.add_svg_width,t.gap=Math.min(t.max_scroll_distance,Math.max(t.max_scroll_distance-n,0));var i=Math.round(t.gap/(2*t.add_x_step));t.select_date_id_bar=t.dataLens-t.showLens-i,t.select_date_id=t.select_date_id_bar+t.select_date_id_slider,e=setTimeout((function(e){if(e===t.scroll_left){t.max_scroll_distance=-t.dataViewWidth+t.add_svg_width,t.gap=Math.min(t.max_scroll_distance,Math.max(t.max_scroll_distance-e,0));var n=Math.round(t.gap/(2*t.add_x_step)),i=t.max_scroll_distance-n*(2*t.add_x_step);a.target.scrollLeft=i}}),100,n)}if(t.isiOS){t.scroll_left=a.target.scrollLeft+a.target.scrollWidth-a.target.clientWidth,clearTimeout(e);var r=t.scroll_left;t.max_scroll_distance=-t.dataViewWidth+t.add_svg_width,t.gap=Math.min(t.max_scroll_distance,Math.max(t.max_scroll_distance-r,0));var s=Math.round(t.gap/(2*t.add_x_step));t.select_date_id_bar=t.dataLens-t.showLens-s,t.select_date_id=t.select_date_id_bar+t.select_date_id_slider,e=setTimeout((function(e){if(e===t.scroll_left){t.max_scroll_distance=-t.dataViewWidth+t.add_svg_width,t.gap=Math.min(t.max_scroll_distance,Math.max(t.max_scroll_distance-e,0));var n=Math.round(t.gap/(2*t.add_x_step)),i=t.max_scroll_distance-n*(2*t.add_x_step);a.target.scrollLeft=i-a.target.scrollWidth+a.target.clientWidth}}),100,r)}}))},num2text:function(t){var e="";if(0===t)return"0";var a=0;while(t>0)3==a&&(e+=",",a=0),e+=t%10,t=parseInt(t/10),a++;return e.split("").reverse().join("")},getCountryDataset:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Object(l["a"])(regeneratorRuntime.mark((function n(){var i,r,s,d,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i={args:{req:{none:""}},service:"THOuterDataServer",func:"getAreaInfo"},r={method:"POST",headers:[["Content-Type","application/json"]],body:JSON.stringify(i)},n.next=4,o["g"](t,r);case 4:return s=n.sent,d=s.args.rsp,c=[],d.chinaHistoryTotal.forEach((function(t){var n=+t["day"].split(".")[1],i=+t["day"].split(".")[0];(i>e||i==e&&n>=a)&&c.push({total_death:t.dead,total_diagnosis:t.confirm,month:i,day:n})})),n.abrupt("return",c);case 9:case"end":return n.stop()}}),n)})))()},compute_add_y_label:function(){var t=0,e=0;this.country_dataset.forEach((function(a){e<a.total_diagnosis&&(e=a.total_diagnosis),t<a.total_death&&(t=a.total_death)})),t=Math.pow(10,2*Math.ceil(Math.log10(t)/2)),e=Math.pow(10,2*Math.ceil(Math.log10(e)/2)),this.add_y_label=[e,Math.sqrt(e),1,1,t]},set_add_svg_params:function(){var t=o["l"](".life_svg_div_mortality").node().getBoundingClientRect();this.add_svg_width=t.width*this.dataLens/this.showLens,this.add_svg_height=t.height,this.add_y_step=this.add_svg_height/5,this.add_x_step=this.add_svg_width/2/(this.dataLens+1.6),this.add_x_begin=.8*this.add_x_step,this.add_x_end=this.add_svg_width-2*this.dataLens*this.add_x_step-this.add_x_begin},initData_tencent:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a="https://ehcard-test.wecity.qq.com/api",n="https://wechat.wecity.qq.com/api",i=e?a:n;Promise.all([this.getCountryDataset(i)]).then((function(e){t.dataLens=Math.min(e[0].length),t.showLens=t.dataLens;var a=e[0];t.country_dataset=a;var n=[];t.country_dataset.forEach((function(t){n.push({month:t.month,day:t.day})})),t.date_list=n,t.select_date_id=n.length-1,t.compute_add_y_label(),t.set_add_svg_params(),t.set_slider(),t.set_scroll_by_addEvent(),t.dataViewWidth=o["l"](".life_svg_div_mortality").node().getBoundingClientRect().width}))}},mounted:function(){this.ScatterPlot.init(),this.initData_tencent(),o["l"](".card-close").on("click",(function(){o["l"]("#data-description").style("display","none")})),/(iPhone|iPad|iPod|iOS|Mac)/i.test(navigator.userAgent)&&(/Safari/.test(navigator.userAgent)&&/Chrome/.test(navigator.userAgent)?this.isiOS=0:this.isiOS=1);var t=navigator.userAgent,e=!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);e&&(this.isiOS=1)}},tt=Q,et=(a("c0f8"),a("2877")),at=Object(et["a"])(tt,d,c,!1,null,null,null),nt=at.exports,it={name:"App",components:{Scatter:nt}},rt=it,st=(a("034f"),Object(et["a"])(rt,r,s,!1,null,null,null)),dt=st.exports;i["a"].config.productionTip=!1,new i["a"]({render:function(t){return t(dt)}}).$mount("#app")},"85ec":function(t,e,a){},c0f8:function(t,e,a){"use strict";var n=a("c7b3"),i=a.n(n);i.a},c7b3:function(t,e,a){}});
//# sourceMappingURL=app.45200661.js.map